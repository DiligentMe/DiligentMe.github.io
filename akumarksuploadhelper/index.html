<!DOCTYPE html>
<!-- saved from url=(0055)http://js-tutorials.com/demos/read_csv_javascript_demo/ -->
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <link rel="stylesheet" href="./css/bootstrap.min.css">
  <link rel="stylesheet" href="./css/prism.css" />
  <script src="./js/osd.js"></script>
  <script src="./js/jquery.min.js"></script>
  <script src="./js/papaparse.min.js"></script>
  <script src="./js/prism.js"></script>
  <title>AKU Internal Marks Auto Fill</title>
  <style>
    .pdfobject-container {
      height: 500px;
    }

    .pdfobject {
      border: 1px solid #666;
    }
  </style>

</head>

<body data-new-gr-c-s-check-loaded="14.1002.0" data-gr-ext-installed="">
  <div class="container" style="padding: 10px; height: auto !important;">
    <h1>AKU Internal Marks Auto Fill</h1>
    <div id="header">
      <div style="padding-bootom:10px">

      </div>
    </div>
    <div class="well">
      <div class="row">
        <form class="form-inline">
          <div class="form-group">
            <label for="files">Upload a CSV file of Marks-<a href="./SampleMarksFile.csv">(Click me to Download Sample file)</a>:</label>
            <input type="file" id="files" class="form-control" accept=".csv" placeholder="Select a CSV File" required />
          </div>
          <div class="form-group">
            <button type="submit" id="submit-file" class="btn btn-primary">Upload File</button>
          </div>

          <div class="form-group" id="codegen" style="display:none">
            <button type="submit" id="generate-code" class="btn btn-primary">Click Me to Generate Code and Go to Next Step!</button>
          </div>
        </form>
      </div>
      <div class="row" <div="" id="parsed_csv_list">
      </div>
      <div class="form-group shadow-textarea" id="gen_code_marks" style="display:none">
        <div class="highlight">
          <pre ><code id="precode" class="language-javascript"></code></pre>
        </div>
        <button class="btn" data-clipboard-action="copy" data-clipboard-target="#precode"><span style="color:blue">Click Me to Copy and See the Next Step!</span> </button>
      </div>
      <div class="form-group" id="instruction" style="display:none">
        <pre>**********Code has been copied********
         Now Follow these steps
1. Open new tab, login to the AKU Marks upload portal
2. Visit to marks upload course page where you want to enter marks
3. Press Ctrl+Shift+j
4. Click on source
5. Click >> symbol, select Snippets
6. Click on "+ New Snippet" Button on left panel
7. Paste (Ctrl+v) the code the you copied from here
8. press Ctrl+Enter (Or click the &#x25BA; icon at the bottom of snippets editor)
9. Its done, all marks must have been entered. Close the window which opened by step 3.</pre>
      </div>
    </div>

  </div>



  <script type="text/javascript">
    $(document).ready(function() {
      $('#header').load('../header-ads.html');
      $('#footer').load('../footer-ads.html');

      $('#submit-file').on("click", function(e) {
        e.preventDefault();
        if (!$('#files')[0].checkValidity()) {
          alert("Please select a formatted CSV File!");
        } else {
          $('#files').parse({
            config: {
              delimiter: "auto",
              complete: displayHTMLTable,
            },
            before: function(file, inputElem) {

              //console.log("Parsing file...", file);
            },
            error: function(err, file) {
              console.log("ERROR:", err, file);
            },
            complete: function() {
              var T = document.getElementById("codegen");
              T.style.display = "block";
              //console.log("Done with all files");
            }
          });
        }
      });

      $('#generate-code').on("click", function(e) {
        e.preventDefault();
        if (!$('#files')[0].checkValidity()) {
          alert("Please select a formatted CSV File!");
        } else {
          $('#files').parse({
            config: {
              delimiter: "auto",
              complete: generateCode,
            },
            before: function(file, inputElem) {
              //console.log("Parsing file...", file);
            },
            error: function(err, file) {
              //console.log("ERROR:", err, file);
            },
            complete: function() {
              //var T = document.getElementById("submit-file");
              //T.style.display = "none";
              //console.log("Done with all files");
            }
          });
        }
      });

      function displayHTMLTable(results) {

        var T = document.getElementById("parsed_csv_list");
        T.style.display = "block";
        var P = document.getElementById("gen_code_marks");
        P.style.display = "none";
        var D = document.getElementById("instruction");
        D.style.display = "none";
        var table = "<table class='table'>";
        var data = results.data;
        if (document.getElementById("files").files.length == 0) {
          alert("Chose a file with Data, Please mind the format!");
        } else {
          for (i = 0; i < data.length; i++) {
            table += "<tr>";
            var row = data[i];
            var cells = row.join(",").split(",");

            for (j = 0; j < cells.length; j++) {
              table += "<td>";
              table += cells[j];
              table += "</th>";
            }
            table += "</tr>";
          }
          table += "</table>";
          $("#parsed_csv_list").html(table);
        }
      }

      function generateCode(results) {
        var T = document.getElementById("parsed_csv_list");
        T.style.display = "none";

        var data = results.data;
        data.shift();
        data.shift();
        var allData = "";
        for (i = 0; i < data.length - 1; i++) {
          var nameFormat=String(data[i]);
          nameFormat = nameFormat.split(",");
          var colCount=nameFormat.length;
          //alert(parseInt(colCount));
          var oneData="";
          for(j = 0 ; j < parseInt(colCount); j++){
            if(j == 1){
              oneData = oneData.concat("\"",nameFormat[j],"\"",",");
            } else if (j == colCount-1 ){
              oneData = oneData.concat(nameFormat[j]);
          }
          else{
            oneData = oneData.concat(nameFormat[j],",");
          }
        }
          //alert(oneData);

          if (i == 0)
            allData = "[[" + oneData + "],";
          else if (i == (data.length - 2))
            allData = allData + "[" + oneData + "]]";
          else
            allData = allData + "[" + oneData + "],";
        }
        //alert(allData);
        var K = document.getElementById("precode");
        K.innerText = "var marks=".concat(allData,';',defaultCode());
        var P = document.getElementById("gen_code_marks");
        P.style.display = "block";
        p.scrollTop=p.scrollHeight;
      }

      function defaultCode(){
        var mT = "var marksTable = document.getElementById('ctl00_mastercontentplaceholder_gvInternalmark');";
        var sC="var studentsCount = document.getElementById('ctl00_mastercontentplaceholder_gvInternalmark').rows.length;";
var f =`function findReg(regNo){
  var R = [];
  for (var i = 0 ; i<marks.length;i++){
      if(regNo == marks[i][2]){
          R = marks[i];
          break;
        }
      }
  return R;
}`;
var l = `for(var i = 2; i<=studentsCount;i++){
  var sNo = (i).toLocaleString('en-US',{minimumIntegerDigits: 2, useGrouping:false});
  var regNumberOnWeb = marksTable.rows[i-1].cells[1].innerText;
  var R = findReg(regNumberOnWeb);
  if(R.length != 0){
      console.log(regNumberOnWeb, document.getElementById('ctl00_mastercontentplaceholder_gvInternalmark_ctl'+sNo+'_txtAttendancemark').value);
    }
  else if (R.length == 0){
      alert(\"For RegNo: \"+regNumberOnWeb+\" Details Not Found-> Check Input File\");
    }
  }`;
        return "\n".concat(mT,"\n",sC,"\n",f,"\n",l);
      }


    });
  </script>
  <script src="./js/clipboard.min.js"></script>
  <script>
    var clipboard = new ClipboardJS('.btn');

    clipboard.on('success', function(e) {
      var T = document.getElementById("instruction");
      T.style.display = "block";
      console.log(e);
    });

    clipboard.on('error', function(e) {
      console.log(e);
    });
  </script>
</body>

</html>
